// Generated by CoffeeScript 1.4.0
(function() {
  var CSFRConfig, ExtractController, MenuController, StateConfig, myapp;

  myapp = angular.module("myapp", ["ui.router", "ui.bootstrap", "angularFileUpload"]);

  StateConfig = function($stateProvider) {
    return $stateProvider.state("index", {
      url: "",
      templateUrl: "/static/partials/index.html",
      abstract: true
    }).state("index.landing", {
      url: "",
      templateUrl: "/static/partials/index.landing.html"
    }).state("index.menu", {
      templateUrl: "/static/partials/index.menu.html",
      controller: MenuController,
      abstract: true
    }).state("index.menu.extract", {
      url: "/extract",
      templateUrl: "/static/partials/index.menu.extract.html",
      controller: ExtractController
    }).state("index.menu.extract.results", {
      url: "/results",
      templateUrl: "/static/partials/index.menu.extract.results.html"
    });
  };

  CSFRConfig = function($httpProvider) {
    $httpProvider.defaults.xsrfCookieName = "csrftoken";
    return $httpProvider.defaults.xsrfHeaderName = "X-CSRFToken";
  };

  myapp.config(StateConfig);

  myapp.config(CSFRConfig);

  MenuController = function($scope, $state) {
    return $scope.$state = $state;
  };

  ExtractController = function($scope, $upload, $http, $state) {
    $scope.uploading = false;
    $scope.select_files = function($files) {
      return $scope.selected_files = $files;
    };
    return $scope.upload_files = function() {
      $scope.uploading = true;
      return $upload.upload({
        url: "/api/extract/",
        file: $scope.selected_files[0]
      }).success(function(data, status, headers, config) {
        $scope.results = data;
        $scope.uploading = false;
        return $state.transitionTo("index.menu.extract.results");
      }).progress(function(evt) {
        return $scope.uploaded_percentage = parseInt(100.0 * evt.loaded / evt.total);
      }).error(function(data) {
        return console.log(data);
      });
    };
  };

}).call(this);
